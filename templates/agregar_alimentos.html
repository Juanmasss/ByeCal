<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ByeCal ‚Äî Alimentos consumidos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='ByeCal.ico') }}">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <div class="container alimentos-consumidos" style="max-width: 1100px; margin: 40px auto; font-family: 'Nunito', sans-serif;">
    <header class="page-header">
  <div class="titulo-con-gif">
    <h1>Alimentos consumidos</h1>
    <img src="{{ url_for('static', filename='cesta-de-la-compra.gif') }}" 
         alt="Cesta de la compra" class="gif-cesta">
  </div>
  <p class="subtitle">Aqu√≠ ver√°s los alimentos que registres durante el d√≠a.</p>
</header>

    <!-- üî• Bloque de calor√≠as -->
    <div class="card calorias-box">
  <div class="info">
    <h2 style="margin-top:0;">Calor√≠as</h2>
    <p><strong>Recomendadas:</strong> {{ calorias_recomendadas }} kcal</p>
    <p><strong>Consumidas:</strong> <span id="consumidas">{{ calorias_consumidas|round(0)|int }}</span> kcal</p>
  </div>

  <div class="circle-progress">
    <svg viewBox="0 0 120 120">
      <circle class="bg" cx="60" cy="60" r="54" />
      <circle class="progress" cx="60" cy="60" r="54" />
      <text id="progress-text" x="60" y="65" text-anchor="middle" font-size="16" fill="#444">0%</text>
    </svg>
  </div>
</div>

    <!-- üî• Tabla de alimentos consumidos -->
    <div class="card card-tabla" style="background:rgba(255, 255, 255, 0.35); border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.08); padding: 16px;">
      <div class="table-responsive" style="overflow-x:auto;">
        <table class="tabla-consumos" style="width:100%; border-collapse:collapse; min-width:760px;">
          <thead>
            <tr>
              <th>#</th>
              <th>Fecha</th>
              <th>Alimento</th>
              <th>Porci√≥n</th>
              <th>Calor√≠as (kcal)</th>
              <th>Prote√≠nas (g)</th>
              <th>Carbohidratos (g)</th>
              <th>Grasas (g)</th>
              <th>Acciones</th> <!-- Nueva columna -->
            </tr>
          </thead>
          <tbody>
            {% if consumos and consumos|length > 0 %}
                {% for c in consumos %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ c.fecha_hora.strftime('%Y-%m-%d %H:%M') if c.fecha_hora else '-' }}</td>
                  <td>{{ c.nombre }}</td>
                  <td>{{ c.porcion or '-' }}</td>
                  <td>{{ (c.calorias or 0)|round(0) }}</td>
                  <td>{{ (c.proteinas or 0)|round(1) }}</td>
                  <td>{{ (c.carbohidratos or 0)|round(1) }}</td>
                  <td>{{ (c.grasas or 0)|round(1) }}</td>
                  <td>
                    <form method="POST" action="{{ url_for('eliminar_consumo', consumo_id=c.id) }}" style="display:inline;">
                      <button type="submit" style="background:#e53935; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">
                        ‚ùå Eliminar
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                  <td colspan="9" class="empty" style="padding:14px; text-align:center; opacity:.7;">
                    No hay registros a√∫n.
                  </td>
                </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- üî• Botones de navegaci√≥n -->
<div class="acciones-nav" style="margin-top: 24px; text-align:center;">
  <a href="{{ url_for('alimentos') }}"  class="btn btn-red" style="margin:8px; border-radius:8px;">
    ‚¨Ö Volver a alimentos
  </a>
  <a href="{{ url_for('dashboard') }}" class="btn btn-red" style="margin:8px; border-radius:8px;">
    üè† Volver al inicio
  </a>
</div>
      </div>
<script>
  const meta = Number('{{ calorias_recomendadas|default(0) }}') || 0;
  const consumidasInicial = Number('{{ calorias_consumidas|default(0) }}') || 0;

  const circle = document.querySelector('.circle-progress .progress');
  const text = document.getElementById('progress-text');

  if (circle && text && meta > 0) {
    const r = 54;
    const circumference = 2 * Math.PI * r;
    circle.style.strokeDasharray = String(circumference);
    circle.style.strokeDashoffset = String(circumference);

    function setProgress(valor) {
      const porcentaje = Math.max(0, Math.min((valor / meta) * 100, 100));
      const offset = circumference - (porcentaje / 100) * circumference;
      circle.style.strokeDashoffset = String(offset);
      text.textContent = `${Math.round(porcentaje)}%`;
    }

    setProgress(consumidasInicial);
  } else {
    const textEl = document.getElementById('progress-text');
    if (textEl) textEl.textContent = '0%';
  }
</script>


</body>
</html>